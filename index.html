<!DOCTYPE html>
<html lang="he" dir="rtl">
	<head>
		<meta charset="UTF-8" />
		<title>המרת תמונה ל־PDF</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<!-- Bootstrap -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />

		<!-- FontAwesome -->
		<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

		<!-- jsPDF -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

		<style>
			body {
				background: linear-gradient(to right, #f9f9f9, #e2eafc);
				min-height: 100vh;
			}
			.container {
				max-width: 500px;
			}
			.custom-label {
				font-weight: bold;
				margin-bottom: 0.5rem;
			}
			.preview-box {
				max-height: 300px;
				object-fit: contain;
				border: 1px solid #ccc;
				padding: 10px;
			}
			.copyright {
				font-size: 0.85rem;
				margin-top: 20px;
				color: #888;
			}
		</style>
	</head>
	<body class="text-center d-flex justify-content-center align-items-center">
		<div class="container bg-white rounded shadow p-4 mt-5">
			<h2 class="mb-4 text-primary">🖼️ המרת תמונה ל־PDF</h2>

			<div class="mb-3 text-start">
				<label for="imageInput" class="custom-label">בחר תמונה:</label>
				<input type="file" id="imageInput" accept="image/jpeg, image/png, image/webp, image/gif, image/bmp, image/tiff" class="form-control" />
			</div>

			<div class="mb-3 text-start">
				<label for="filenameInput" class="custom-label">שם הקובץ לשמירה:</label>
				<input type="text" id="filenameInput" class="form-control" placeholder="למשל: התמונה שלי" />
			</div>

			<div class="mb-3">
				<img id="preview" src="#" alt="תצוגה מקדימה" class="img-fluid preview-box d-none" />
			</div>

			<button onclick="convertToPDF()" class="btn btn-success w-100"><i class="fa-solid fa-file-pdf me-2"></i>המר ושמור PDF</button>

			<div class="copyright">Uriel Dahan 2026. All rights reserved ©</div>
		</div>

		<script>
			const imageInput = document.getElementById('imageInput');
			const preview = document.getElementById('preview');

			// Image preview handler
			imageInput.addEventListener('change', function () {
				const file = this.files[0];
				if (!file) return;

				// Validate MIME type
				const validTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif', 'image/bmp', 'image/tiff'];
				if (!validTypes.includes(file.type)) {
					alert('Unsupported file type. Please select a valid image.');
					imageInput.value = '';
					return;
				}

				// Display preview
				const reader = new FileReader();
				reader.onload = function (e) {
					preview.src = e.target.result;
					preview.classList.remove('d-none');
				};
				reader.readAsDataURL(file);
			});

			// Convert image to A4 PDF
			async function convertToPDF() {
				if (!imageInput.files.length) {
					alert('Please select an image first.');
					return;
				}

				const file = imageInput.files[0];
				const validTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif', 'image/bmp', 'image/tiff'];
				if (!validTypes.includes(file.type)) {
					alert('Unsupported file type.');
					return;
				}

				const fileNameInput = document.getElementById('filenameInput').value.trim();
				const fileName = fileNameInput !== '' ? fileNameInput : 'converted';

				const reader = new FileReader();
				reader.onload = function (e) {
					const img = new Image();
					img.onload = function () {
						const { jsPDF } = window.jspdf;
						const pdf = new jsPDF({ unit: 'mm', format: 'a4' });

						const pageWidth = pdf.internal.pageSize.getWidth();
						const pageHeight = pdf.internal.pageSize.getHeight();

						const imgRatio = img.width / img.height;
						const pageRatio = pageWidth / pageHeight;

						let imgWidth, imgHeight;
						if (imgRatio > pageRatio) {
							imgWidth = pageWidth;
							imgHeight = pageWidth / imgRatio;
						} else {
							imgHeight = pageHeight;
							imgWidth = pageHeight * imgRatio;
						}

						const x = (pageWidth - imgWidth) / 2;
						const y = (pageHeight - imgHeight) / 2;

						pdf.addImage(img, 'JPEG', x, y, imgWidth, imgHeight);
						pdf.save(fileName + '.pdf');

						// Reset UI after saving
						imageInput.value = '';
						document.getElementById('filenameInput').value = '';
						preview.classList.add('d-none');
						preview.src = '#';
					};
					img.src = e.target.result;
				};

				reader.readAsDataURL(file);
			}
		</script>
	</body>
</html>
